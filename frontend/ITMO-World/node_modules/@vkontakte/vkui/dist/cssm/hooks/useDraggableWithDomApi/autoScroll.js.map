{"version":3,"sources":["../../../../src/hooks/useDraggableWithDomApi/autoScroll.ts"],"sourcesContent":["import { getNodeScroll, getScrollHeight, getScrollRect } from '../../lib/dom';\nimport { rafSchd } from '../../lib/rafSchd';\n\nconst SCROLL_SPEED = 10;\nexport const EDGE_SIZE = 50;\n\nexport const getAutoScrollingData = (\n  clientY: number,\n  scrollEl: Element | Window,\n): {\n  shouldScrolling: boolean;\n  y: number;\n} => {\n  const scrollTop = Math.floor(getNodeScroll(scrollEl).scrollTop);\n\n  const { relative, edges } = getScrollRect(scrollEl);\n  const viewportHeight = relative.height;\n  const documentHeight = getScrollHeight(scrollEl);\n  const maxScrollY = documentHeight - viewportHeight;\n  const canScrollUp = scrollTop > 0;\n  const canScrollDown = scrollTop < maxScrollY;\n\n  const [edgeTop, edgeBottom] = edges.y;\n  const topDistance = clientY - edgeTop;\n  const bottomDistance = edgeBottom - clientY;\n  const isInTopEdge = topDistance <= EDGE_SIZE;\n  const isInBottomEdge = bottomDistance <= EDGE_SIZE;\n\n  const result = {\n    shouldScrolling: (canScrollUp && isInTopEdge) || (canScrollDown && isInBottomEdge),\n    y: 0,\n  };\n\n  // Inspired by https://github.com/SortableJS/Sortable/issues/1907#issuecomment-1495403785\n  if (isInTopEdge) {\n    result.y = -1 * ((EDGE_SIZE - topDistance) / EDGE_SIZE) * SCROLL_SPEED;\n  } else if (isInBottomEdge) {\n    result.y = ((EDGE_SIZE - bottomDistance) / EDGE_SIZE) * SCROLL_SPEED;\n  }\n\n  return result;\n};\n\nexport type AutoScrollingDataFn = () => { shouldScrolling: boolean; y: number };\n\nexport const createAutoScrollController = (\n  scrollEl: Element | Window,\n): {\n  tryAutoScroll: (fn: AutoScrollingDataFn) => void;\n  stop: () => void;\n  readonly isRunning: boolean;\n} => {\n  let isRunning = false;\n  const scheduledScroll = rafSchd(scroll);\n\n  function scroll(fn: AutoScrollingDataFn) {\n    const { shouldScrolling, y } = fn();\n    if (shouldScrolling) {\n      isRunning = true;\n      scrollEl.scrollBy(0, y);\n      scheduledScroll(fn);\n    } else {\n      isRunning = false;\n      scheduledScroll.cancel();\n    }\n  }\n\n  const tryAutoScroll = (fn: AutoScrollingDataFn) => {\n    scheduledScroll(fn);\n  };\n\n  const stop = () => {\n    isRunning = false;\n    scheduledScroll.cancel();\n  };\n\n  return {\n    tryAutoScroll,\n    stop,\n    get isRunning() {\n      return isRunning;\n    },\n  };\n};\n"],"names":["getNodeScroll","getScrollHeight","getScrollRect","rafSchd","SCROLL_SPEED","EDGE_SIZE","getAutoScrollingData","clientY","scrollEl","scrollTop","Math","floor","relative","edges","viewportHeight","height","documentHeight","maxScrollY","canScrollUp","canScrollDown","edgeTop","edgeBottom","y","topDistance","bottomDistance","isInTopEdge","isInBottomEdge","result","shouldScrolling","createAutoScrollController","isRunning","scheduledScroll","scroll","fn","scrollBy","cancel","tryAutoScroll","stop"],"mappings":"AAAA,SAASA,aAAa,EAAEC,eAAe,EAAEC,aAAa,QAAQ,gBAAgB;AAC9E,SAASC,OAAO,QAAQ,oBAAoB;AAE5C,MAAMC,eAAe;AACrB,OAAO,MAAMC,YAAY,GAAG;AAE5B,OAAO,MAAMC,uBAAuB,CAClCC,SACAC;IAKA,MAAMC,YAAYC,KAAKC,KAAK,CAACX,cAAcQ,UAAUC,SAAS;IAE9D,MAAM,EAAEG,QAAQ,EAAEC,KAAK,EAAE,GAAGX,cAAcM;IAC1C,MAAMM,iBAAiBF,SAASG,MAAM;IACtC,MAAMC,iBAAiBf,gBAAgBO;IACvC,MAAMS,aAAaD,iBAAiBF;IACpC,MAAMI,cAAcT,YAAY;IAChC,MAAMU,gBAAgBV,YAAYQ;IAElC,MAAM,CAACG,SAASC,WAAW,GAAGR,MAAMS,CAAC;IACrC,MAAMC,cAAchB,UAAUa;IAC9B,MAAMI,iBAAiBH,aAAad;IACpC,MAAMkB,cAAcF,eAAelB;IACnC,MAAMqB,iBAAiBF,kBAAkBnB;IAEzC,MAAMsB,SAAS;QACbC,iBAAiB,AAACV,eAAeO,eAAiBN,iBAAiBO;QACnEJ,GAAG;IACL;IAEA,yFAAyF;IACzF,IAAIG,aAAa;QACfE,OAAOL,CAAC,GAAG,CAAC,IAAK,CAAA,AAACjB,CAAAA,YAAYkB,WAAU,IAAKlB,SAAQ,IAAKD;IAC5D,OAAO,IAAIsB,gBAAgB;QACzBC,OAAOL,CAAC,GAAG,AAAEjB,CAAAA,YAAYmB,cAAa,IAAKnB,YAAaD;IAC1D;IAEA,OAAOuB;AACT,EAAE;AAIF,OAAO,MAAME,6BAA6B,CACxCrB;IAMA,IAAIsB,YAAY;IAChB,MAAMC,kBAAkB5B,QAAQ6B;IAEhC,SAASA,OAAOC,EAAuB;QACrC,MAAM,EAAEL,eAAe,EAAEN,CAAC,EAAE,GAAGW;QAC/B,IAAIL,iBAAiB;YACnBE,YAAY;YACZtB,SAAS0B,QAAQ,CAAC,GAAGZ;YACrBS,gBAAgBE;QAClB,OAAO;YACLH,YAAY;YACZC,gBAAgBI,MAAM;QACxB;IACF;IAEA,MAAMC,gBAAgB,CAACH;QACrBF,gBAAgBE;IAClB;IAEA,MAAMI,OAAO;QACXP,YAAY;QACZC,gBAAgBI,MAAM;IACxB;IAEA,OAAO;QACLC;QACAC;QACA,IAAIP,aAAY;YACd,OAAOA;QACT;IACF;AACF,EAAE"}