{"version":3,"sources":["../../src/hooks/useExternRef.ts"],"sourcesContent":["import * as React from 'react';\nimport { setRef } from '../lib/utils';\n\nclass ExternalRef<T> implements React.MutableRefObject<T | null> {\n  #element: T | null = null;\n  readonly #externRefs = new Set<React.Ref<T>>();\n\n  constructor(externRefs: Array<React.Ref<T> | undefined | false> = []) {\n    externRefs.forEach((ref) => {\n      if (ref) {\n        this.#externRefs.add(ref);\n      }\n    });\n  }\n\n  updateExternRefs(refs: Array<React.Ref<T> | undefined | false>) {\n    refs.forEach((ref) => {\n      if (!ref || this.#externRefs.has(ref)) {\n        return;\n      }\n\n      setRef(this.#element, ref);\n      this.#externRefs.add(ref);\n    });\n  }\n\n  get current() {\n    return this.#element;\n  }\n\n  set current(el) {\n    this.#element = el;\n    this.#externRefs.forEach((ref) => setRef(el, ref));\n  }\n\n  /**\n   * React проверяет наличие свойства current у объектов через hasOwnProperty\n   *\n   * https://github.com/facebook/react/blob/c3cdbec0a78d39b5ff7329384cb41c4573a38212/packages/react-reconciler/src/ReactFiberCommitWork.js#L1612\n   */\n  hasOwnProperty(v: PropertyKey): v is keyof ExternalRef<T> {\n    return v === 'current';\n  }\n}\n\nexport function useExternRef<T>(\n  ...externRefs: Array<React.Ref<T> | undefined | false>\n): React.MutableRefObject<T | null> {\n  const ref = React.useRef<ExternalRef<T> | null>(null);\n  if (ref.current === null) {\n    ref.current = new ExternalRef(externRefs);\n  } else {\n    ref.current.updateExternRefs(externRefs);\n  }\n\n  return ref.current;\n}\n"],"names":["React","setRef","ExternalRef","updateExternRefs","refs","forEach","ref","has","add","current","el","hasOwnProperty","v","constructor","externRefs","Set","useExternRef","useRef"],"mappings":";;;AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,MAAM,QAAQ,eAAe;IAGpC,wCACS;AAFX,MAAMC;IAYJC,iBAAiBC,IAA6C,EAAE;QAC9DA,KAAKC,OAAO,CAAC,CAACC;YACZ,IAAI,CAACA,OAAO,yBAAA,IAAI,EAAC,aAAYC,GAAG,CAACD,MAAM;gBACrC;YACF;YAEAL,gCAAO,IAAI,EAAC,WAAUK;YACtB,yBAAA,IAAI,EAAC,aAAYE,GAAG,CAACF;QACvB;IACF;IAEA,IAAIG,UAAU;QACZ,gCAAO,IAAI,EAAC;IACd;IAEA,IAAIA,QAAQC,EAAE,EAAE;uCACT,UAAWA;QAChB,yBAAA,IAAI,EAAC,aAAYL,OAAO,CAAC,CAACC,MAAQL,OAAOS,IAAIJ;IAC/C;IAEA;;;;GAIC,GACDK,eAAeC,CAAc,EAA6B;QACxD,OAAOA,MAAM;IACf;IAnCAC,YAAYC,aAAsD,EAAE,CAAE;QAHtE,gCAAA;;mBAAqB;;QACrB,gCAAS;;mBAAc,IAAIC;;QAGzBD,WAAWT,OAAO,CAAC,CAACC;YAClB,IAAIA,KAAK;gBACP,yBAAA,IAAI,EAAC,aAAYE,GAAG,CAACF;YACvB;QACF;IACF;AA8BF;AAEA,OAAO,SAASU,aACd,GAAGF,UAAmD;IAEtD,MAAMR,MAAMN,MAAMiB,MAAM,CAAwB;IAChD,IAAIX,IAAIG,OAAO,KAAK,MAAM;QACxBH,IAAIG,OAAO,GAAG,IAAIP,YAAYY;IAChC,OAAO;QACLR,IAAIG,OAAO,CAACN,gBAAgB,CAACW;IAC/B;IAEA,OAAOR,IAAIG,OAAO;AACpB"}