{"version":3,"sources":["../../../../src/components/CustomScrollView/useVerticalScrollController.tsx"],"sourcesContent":["import * as React from 'react';\nimport type { CustomScrollBarController } from './types';\nimport { useTrackerVisibility } from './useTrackerVisibility';\n\nexport const useVerticalScrollController = (\n  boxRef: React.RefObject<HTMLDivElement | null>,\n  autoHideScrollbar: boolean,\n  autoHideScrollbarDelay?: number,\n): CustomScrollBarController => {\n  const barY = React.useRef<HTMLDivElement>(null);\n\n  const verticalRatio = React.useRef(NaN);\n  const lastTrackerTop = React.useRef(0);\n  const clientHeight = React.useRef(0);\n  const trackerHeight = React.useRef(0);\n  const scrollHeight = React.useRef(0);\n  const startY = React.useRef(0);\n  const trackerTop = React.useRef(0);\n\n  const trackerY = React.useRef<HTMLDivElement>(null);\n\n  const {\n    trackerVisible,\n    onTargetScroll,\n    onTrackerDragStart,\n    onTrackerDragStop,\n    onTrackerMouseEnter,\n    onTrackerMouseLeave,\n  } = useTrackerVisibility(autoHideScrollbar, autoHideScrollbarDelay);\n\n  const setVerticalTrackerPosition = (scrollTop: number) => {\n    lastTrackerTop.current = scrollTop;\n    if (trackerY.current !== null) {\n      trackerY.current.style.transform = `translate(0, ${scrollTop}px)`;\n    }\n  };\n\n  const setTrackerPositionFromScroll = (scrollTop: number) => {\n    const progress = scrollTop / (scrollHeight.current - clientHeight.current);\n    setVerticalTrackerPosition((clientHeight.current - trackerHeight.current) * progress);\n  };\n\n  const resize = () => {\n    if (!boxRef.current || !barY.current || !trackerY.current) {\n      return;\n    }\n    const localClientHeight = boxRef.current.clientHeight;\n    const localScrollHeight = boxRef.current.scrollHeight;\n    const localVerticalRatio = localClientHeight / localScrollHeight;\n    const localTrackerHeight = Math.max(localClientHeight * localVerticalRatio, 40);\n\n    verticalRatio.current = localVerticalRatio;\n    clientHeight.current = localClientHeight;\n    scrollHeight.current = localScrollHeight;\n    trackerHeight.current = localTrackerHeight;\n\n    const currentScrollTop = boxRef.current.scrollTop;\n\n    if (localVerticalRatio >= 1) {\n      barY.current.style.display = 'none';\n    } else {\n      barY.current.style.display = '';\n      trackerY.current.style.height = `${localTrackerHeight}px`;\n      setTrackerPositionFromScroll(currentScrollTop);\n    }\n  };\n\n  const setScrollPositionFromTracker = (trackerTop: number) => {\n    const progress = trackerTop / (clientHeight.current - trackerHeight.current);\n    if (boxRef.current !== null) {\n      boxRef.current.scroll({\n        top: (scrollHeight.current - clientHeight.current) * progress,\n      });\n    }\n  };\n\n  const dragging = (e: React.MouseEvent) => {\n    const diff = e.clientY - startY.current;\n    const position = Math.min(\n      Math.max(trackerTop.current + diff, 0),\n      clientHeight.current - trackerHeight.current,\n    );\n\n    setScrollPositionFromTracker(position);\n  };\n\n  const dragEnd = () => {\n    if (autoHideScrollbar) {\n      onTrackerDragStop();\n    }\n  };\n\n  const scroll = () => {\n    if (!boxRef.current) {\n      return;\n    }\n    if (autoHideScrollbar) {\n      onTargetScroll();\n    }\n    setTrackerPositionFromScroll(boxRef.current.scrollTop);\n  };\n\n  const dragStart = (e: React.MouseEvent) => {\n    startY.current = e.clientY;\n    trackerTop.current = lastTrackerTop.current;\n\n    if (autoHideScrollbar) {\n      onTrackerDragStart();\n    }\n  };\n\n  return {\n    barRef: barY,\n    trackerVisible,\n    trackerRef: trackerY,\n    resize,\n    dragging,\n    dragEnd,\n    scroll,\n    dragStart,\n    trackerMouseEnter: onTrackerMouseEnter,\n    trackerMouseLeave: onTrackerMouseLeave,\n  };\n};\n"],"names":["useVerticalScrollController","boxRef","autoHideScrollbar","autoHideScrollbarDelay","barY","React","useRef","verticalRatio","NaN","lastTrackerTop","clientHeight","trackerHeight","scrollHeight","startY","trackerTop","trackerY","trackerVisible","onTargetScroll","onTrackerDragStart","onTrackerDragStop","onTrackerMouseEnter","onTrackerMouseLeave","useTrackerVisibility","setVerticalTrackerPosition","scrollTop","current","style","transform","setTrackerPositionFromScroll","progress","resize","localClientHeight","localScrollHeight","localVerticalRatio","localTrackerHeight","Math","max","currentScrollTop","display","height","setScrollPositionFromTracker","scroll","top","dragging","e","diff","clientY","position","min","dragEnd","dragStart","barRef","trackerRef","trackerMouseEnter","trackerMouseLeave"],"mappings":"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"}