{"version":3,"sources":["../../../../src/components/ActionSheet/ActionSheet.tsx"],"sourcesContent":["import * as React from 'react';\nimport { noop } from '@vkontakte/vkjs';\nimport { useAdaptivityWithJSMediaQueries } from '../../hooks/useAdaptivityWithJSMediaQueries';\nimport { useObjectMemo } from '../../hooks/useObjectMemo';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useCSSKeyframesAnimationController } from '../../lib/animation';\nimport { useScrollLock } from '../AppRoot/ScrollContext';\nimport { PopoutWrapper } from '../PopoutWrapper/PopoutWrapper';\nimport { Footnote } from '../Typography/Footnote/Footnote';\nimport { ActionSheetContext, type ItemClickHandler } from './ActionSheetContext';\nimport { ActionSheetDefaultIosCloseItem } from './ActionSheetDefaultIosCloseItem';\nimport { ActionSheetDropdownMenu } from './ActionSheetDropdownMenu';\nimport { ActionSheetDropdownSheet } from './ActionSheetDropdownSheet';\nimport type { SharedDropdownProps } from './types';\nimport styles from './ActionSheet.module.css';\n\ntype CloseInitiators = 'action-item' | 'cancel-item' | 'other';\nexport interface ActionSheetOnCloseOptions {\n  closedBy: CloseInitiators;\n}\n\nexport interface ActionSheetProps\n  extends Pick<\n      SharedDropdownProps,\n      'toggleRef' | 'popupOffsetDistance' | 'placement' | 'autoFocus'\n    >,\n    Omit<React.HTMLAttributes<HTMLDivElement>, 'autoFocus'> {\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  /**\n   * Закрыть попап по клику снаружи.\n   */\n  onClose: (options: ActionSheetOnCloseOptions) => void;\n  /**\n   * Только мобильный iOS.\n   */\n  iosCloseItem?: React.ReactNode;\n  mode?: 'sheet' | 'menu';\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/ActionSheet\n */\nexport const ActionSheet = ({\n  children,\n  className,\n  header,\n  text,\n  style,\n  iosCloseItem,\n  popupOffsetDistance,\n  placement,\n  mode: modeProp,\n  onClose,\n  ...restProps\n}: ActionSheetProps): React.ReactNode => {\n  const platform = usePlatform();\n  const [closingBy, setClosingBy] = React.useState<undefined | CloseInitiators>(undefined);\n  const onCloseWithOther = () => setClosingBy('other');\n  const actionCallbackRef = React.useRef(noop);\n\n  const [animationState, animationHandlers] = useCSSKeyframesAnimationController(\n    closingBy !== undefined ? 'exit' : 'enter',\n    {\n      onExited() {\n        onClose({ closedBy: closingBy || 'other' });\n        actionCallbackRef.current();\n        actionCallbackRef.current = noop;\n      },\n    },\n  );\n\n  const { isDesktop } = useAdaptivityWithJSMediaQueries();\n  const mode = modeProp ?? (isDesktop ? 'menu' : 'sheet');\n\n  useScrollLock(mode === 'sheet');\n\n  const onItemClick = React.useCallback<ItemClickHandler>(\n    ({ action, immediateAction, autoClose, isCancelItem }) =>\n      (event) => {\n        event.persist();\n        immediateAction && immediateAction(event);\n        if (autoClose) {\n          if (action) {\n            actionCallbackRef.current = () => action(event);\n          }\n          setClosingBy(isCancelItem ? 'cancel-item' : 'action-item');\n        } else {\n          action && action(event);\n        }\n      },\n    [],\n  );\n  const contextValue = useObjectMemo({ onItemClick, mode, onClose: onCloseWithOther });\n\n  const DropdownComponent = mode === 'menu' ? ActionSheetDropdownMenu : ActionSheetDropdownSheet;\n\n  const dropdownProps =\n    mode === 'menu' ? Object.assign(restProps, { popupOffsetDistance, placement }) : restProps;\n\n  const actionSheet = (\n    <ActionSheetContext.Provider value={contextValue}>\n      <DropdownComponent\n        closing={Boolean(closingBy)}\n        role=\"dialog\"\n        aria-modal=\"true\"\n        autoFocus={animationState === 'entered'}\n        {...dropdownProps}\n        {...animationHandlers}\n        onClose={onCloseWithOther}\n        className={mode === 'menu' ? className : undefined}\n        style={mode === 'menu' ? style : undefined}\n      >\n        <div className={styles['ActionSheet__content-wrapper']}>\n          {(header || text) && (\n            <div className={styles['ActionSheet__header']}>\n              {header && (\n                <Footnote weight=\"2\" className={styles['ActionSheet__title']}>\n                  {header}\n                </Footnote>\n              )}\n              {text && <Footnote className={styles['ActionSheet__text']}>{text}</Footnote>}\n            </div>\n          )}\n          {children}\n        </div>\n        {platform === 'ios' && mode === 'sheet' && (\n          <div className={styles['ActionSheet__close-item-wrapper--ios']}>\n            {iosCloseItem ?? <ActionSheetDefaultIosCloseItem />}\n          </div>\n        )}\n      </DropdownComponent>\n    </ActionSheetContext.Provider>\n  );\n\n  if (mode === 'menu') {\n    return actionSheet;\n  }\n\n  return (\n    <PopoutWrapper\n      closing={Boolean(closingBy)}\n      alignY=\"bottom\"\n      className={className}\n      style={style}\n      onClick={onCloseWithOther}\n      fixed\n    >\n      {actionSheet}\n    </PopoutWrapper>\n  );\n};\n"],"names":["ActionSheet","children","className","header","text","style","iosCloseItem","popupOffsetDistance","placement","mode","modeProp","onClose","restProps","platform","usePlatform","closingBy","setClosingBy","React","useState","undefined","onCloseWithOther","actionCallbackRef","useRef","noop","animationState","animationHandlers","useCSSKeyframesAnimationController","onExited","closedBy","current","isDesktop","useAdaptivityWithJSMediaQueries","useScrollLock","onItemClick","useCallback","action","immediateAction","autoClose","isCancelItem","event","persist","contextValue","useObjectMemo","DropdownComponent","ActionSheetDropdownMenu","ActionSheetDropdownSheet","dropdownProps","Object","assign","actionSheet","ActionSheetContext","Provider","value","closing","Boolean","role","aria-modal","autoFocus","div","Footnote","weight","ActionSheetDefaultIosCloseItem","PopoutWrapper","alignY","onClick","fixed"],"mappings":";;;;+BA2CaA;;;eAAAA;;;;;;;;iEA3CU;sBACF;iDAC2B;+BAClB;6BACF;2BACuB;+BACrB;+BACA;0BACL;oCACiC;gDACX;yCACP;0CACC;AA+BlC,MAAMA,cAAc;QAAC,EAC1BC,QAAQ,EACRC,SAAS,EACTC,MAAM,EACNC,IAAI,EACJC,KAAK,EACLC,YAAY,EACZC,mBAAmB,EACnBC,SAAS,EACTC,MAAMC,QAAQ,EACdC,OAAO,EAEU,WADdC;QAVHX;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAE;;IAGA,MAAME,WAAWC,IAAAA,wBAAW;IAC5B,MAAM,CAACC,WAAWC,aAAa,GAAGC,OAAMC,QAAQ,CAA8BC;IAC9E,MAAMC,mBAAmB,IAAMJ,aAAa;IAC5C,MAAMK,oBAAoBJ,OAAMK,MAAM,CAACC,UAAI;IAE3C,MAAM,CAACC,gBAAgBC,kBAAkB,GAAGC,IAAAA,6CAAkC,EAC5EX,cAAcI,YAAY,SAAS,SACnC;QACEQ;YACEhB,QAAQ;gBAAEiB,UAAUb,aAAa;YAAQ;YACzCM,kBAAkBQ,OAAO;YACzBR,kBAAkBQ,OAAO,GAAGN,UAAI;QAClC;IACF;IAGF,MAAM,EAAEO,SAAS,EAAE,GAAGC,IAAAA,gEAA+B;IACrD,MAAMtB,OAAOC,qBAAAA,sBAAAA,WAAaoB,YAAY,SAAS;IAE/CE,IAAAA,4BAAa,EAACvB,SAAS;IAEvB,MAAMwB,cAAchB,OAAMiB,WAAW,CACnC,CAAC,EAAEC,MAAM,EAAEC,eAAe,EAAEC,SAAS,EAAEC,YAAY,EAAE,GACnD,CAACC;YACCA,MAAMC,OAAO;YACbJ,mBAAmBA,gBAAgBG;YACnC,IAAIF,WAAW;gBACb,IAAIF,QAAQ;oBACVd,kBAAkBQ,OAAO,GAAG,IAAMM,OAAOI;gBAC3C;gBACAvB,aAAasB,eAAe,gBAAgB;YAC9C,OAAO;gBACLH,UAAUA,OAAOI;YACnB;QACF,GACF,EAAE;IAEJ,MAAME,eAAeC,IAAAA,4BAAa,EAAC;QAAET;QAAaxB;QAAME,SAASS;IAAiB;IAElF,MAAMuB,oBAAoBlC,SAAS,SAASmC,gDAAuB,GAAGC,kDAAwB;IAE9F,MAAMC,gBACJrC,SAAS,SAASsC,OAAOC,MAAM,CAACpC,WAAW;QAAEL;QAAqBC;IAAU,KAAKI;IAEnF,MAAMqC,4BACJ,qBAACC,sCAAkB,CAACC,QAAQ;QAACC,OAAOX;kBAClC,cAAA,sBAACE;YACCU,SAASC,QAAQvC;YACjBwC,MAAK;YACLC,cAAW;YACXC,WAAWjC,mBAAmB;WAC1BsB,eACArB;YACJd,SAASS;YACTlB,WAAWO,SAAS,SAASP,YAAYiB;YACzCd,OAAOI,SAAS,SAASJ,QAAQc;;8BAEjC,sBAACuC;oBAAIxD,SAAS;;wBACVC,CAAAA,UAAUC,IAAG,mBACb,sBAACsD;4BAAIxD,SAAS;;gCACXC,wBACC,qBAACwD,kBAAQ;oCAACC,QAAO;oCAAI1D,SAAS;8CAC3BC;;gCAGJC,sBAAQ,qBAACuD,kBAAQ;oCAACzD,SAAS;8CAAgCE;;;;wBAG/DH;;;gBAEFY,aAAa,SAASJ,SAAS,yBAC9B,qBAACiD;oBAAIxD,SAAS;8BACXI,yBAAAA,0BAAAA,6BAAgB,qBAACuD,8DAA8B;;;;;IAO1D,IAAIpD,SAAS,QAAQ;QACnB,OAAOwC;IACT;IAEA,qBACE,qBAACa,4BAAa;QACZT,SAASC,QAAQvC;QACjBgD,QAAO;QACP7D,WAAWA;QACXG,OAAOA;QACP2D,SAAS5C;QACT6C,KAAK;kBAEJhB;;AAGP"}