{"version":3,"sources":["../../../../src/components/Clickable/useStateWithDelay.tsx"],"sourcesContent":["import * as React from 'react';\nimport { isFunction, noop } from '@vkontakte/vkjs';\n\ntype DispatchWithDelay<S> = (value: S, delay?: number) => void;\n\n/**\n * Возвращает значение с состоянием и функции на обновление состояния\n * без и с задержкой.\n *\n * # Пример\n *\n * ```ts\n * const [count, setCount] = useStateWithDelay(initialState);\n *\n * const click = () => {\n *   setCount(count + 1, 500)\n * }\n * ```\n *\n * Есть возможность передать функцию-коллбэк, которая будет\n * вызвана сразу после вызова setState с новым значением стейта\n * в качестве аргумента.\n *\n * ```ts\n * const onCountChange = React.useCallback((count) => {\n *   // обработчик нового значения count\n *   // будет вызван через 500мс\n * }, []);\n *\n *\n * const [count, setCount] = useStateWithDelay(initialState, 0, onCountChange);\n *\n * const click = () => {\n *   setCount(count + 1, 500)\n * }\n * ```\n */\nexport function useStateWithDelay<S>(\n  initialState: S | (() => S),\n  defaultDelay = 0,\n  onStateChange: (v: S) => void = noop,\n): [S, DispatchWithDelay<React.SetStateAction<S>>] {\n  const [value, setValue] = React.useState(initialState);\n  const timeout = React.useRef<ReturnType<typeof setTimeout>>();\n\n  const handleSetValue = React.useCallback(\n    (nextValue: React.SetStateAction<S>) => {\n      if (isFunction(nextValue)) {\n        setValue((prevValue) => {\n          const value = nextValue(prevValue);\n          onStateChange(value);\n\n          return value;\n        });\n      } else {\n        setValue(nextValue);\n        onStateChange(nextValue);\n      }\n    },\n    [onStateChange],\n  );\n\n  const setValueWithDelay = React.useCallback(\n    (newValue: React.SetStateAction<S>, delay: number = defaultDelay) => {\n      clearTimeout(timeout.current);\n      if (delay === 0) {\n        handleSetValue(newValue);\n        return;\n      }\n\n      timeout.current = setTimeout(() => handleSetValue(newValue), delay);\n    },\n    [defaultDelay, handleSetValue],\n  );\n\n  return [value, setValueWithDelay];\n}\n"],"names":["useStateWithDelay","initialState","defaultDelay","onStateChange","noop","value","setValue","React","useState","timeout","useRef","handleSetValue","useCallback","nextValue","isFunction","prevValue","setValueWithDelay","newValue","delay","clearTimeout","current","setTimeout"],"mappings":";;;;+BAqCgBA;;;eAAAA;;;;iEArCO;sBACU;AAoC1B,SAASA,kBACdC,YAA2B,EAC3BC,eAAe,CAAC,EAChBC,gBAAgCC,UAAI;IAEpC,MAAM,CAACC,OAAOC,SAAS,GAAGC,OAAMC,QAAQ,CAACP;IACzC,MAAMQ,UAAUF,OAAMG,MAAM;IAE5B,MAAMC,iBAAiBJ,OAAMK,WAAW,CACtC,CAACC;QACC,IAAIC,IAAAA,gBAAU,EAACD,YAAY;YACzBP,SAAS,CAACS;gBACR,MAAMV,QAAQQ,UAAUE;gBACxBZ,cAAcE;gBAEd,OAAOA;YACT;QACF,OAAO;YACLC,SAASO;YACTV,cAAcU;QAChB;IACF,GACA;QAACV;KAAc;IAGjB,MAAMa,oBAAoBT,OAAMK,WAAW,CACzC,CAACK,UAAmCC,QAAgBhB,YAAY;QAC9DiB,aAAaV,QAAQW,OAAO;QAC5B,IAAIF,UAAU,GAAG;YACfP,eAAeM;YACf;QACF;QAEAR,QAAQW,OAAO,GAAGC,WAAW,IAAMV,eAAeM,WAAWC;IAC/D,GACA;QAAChB;QAAcS;KAAe;IAGhC,OAAO;QAACN;QAAOW;KAAkB;AACnC"}