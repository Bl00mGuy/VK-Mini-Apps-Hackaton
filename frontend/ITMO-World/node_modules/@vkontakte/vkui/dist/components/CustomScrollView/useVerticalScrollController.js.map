{"version":3,"sources":["../../../src/components/CustomScrollView/useVerticalScrollController.tsx"],"sourcesContent":["import * as React from 'react';\nimport type { CustomScrollBarController } from './types';\nimport { useTrackerVisibility } from './useTrackerVisibility';\n\nexport const useVerticalScrollController = (\n  boxRef: React.RefObject<HTMLDivElement | null>,\n  autoHideScrollbar: boolean,\n  autoHideScrollbarDelay?: number,\n): CustomScrollBarController => {\n  const barY = React.useRef<HTMLDivElement>(null);\n\n  const verticalRatio = React.useRef(NaN);\n  const lastTrackerTop = React.useRef(0);\n  const clientHeight = React.useRef(0);\n  const trackerHeight = React.useRef(0);\n  const scrollHeight = React.useRef(0);\n  const startY = React.useRef(0);\n  const trackerTop = React.useRef(0);\n\n  const trackerY = React.useRef<HTMLDivElement>(null);\n\n  const {\n    trackerVisible,\n    onTargetScroll,\n    onTrackerDragStart,\n    onTrackerDragStop,\n    onTrackerMouseEnter,\n    onTrackerMouseLeave,\n  } = useTrackerVisibility(autoHideScrollbar, autoHideScrollbarDelay);\n\n  const setVerticalTrackerPosition = (scrollTop: number) => {\n    lastTrackerTop.current = scrollTop;\n    if (trackerY.current !== null) {\n      trackerY.current.style.transform = `translate(0, ${scrollTop}px)`;\n    }\n  };\n\n  const setTrackerPositionFromScroll = (scrollTop: number) => {\n    const progress = scrollTop / (scrollHeight.current - clientHeight.current);\n    setVerticalTrackerPosition((clientHeight.current - trackerHeight.current) * progress);\n  };\n\n  const resize = () => {\n    if (!boxRef.current || !barY.current || !trackerY.current) {\n      return;\n    }\n    const localClientHeight = boxRef.current.clientHeight;\n    const localScrollHeight = boxRef.current.scrollHeight;\n    const localVerticalRatio = localClientHeight / localScrollHeight;\n    const localTrackerHeight = Math.max(localClientHeight * localVerticalRatio, 40);\n\n    verticalRatio.current = localVerticalRatio;\n    clientHeight.current = localClientHeight;\n    scrollHeight.current = localScrollHeight;\n    trackerHeight.current = localTrackerHeight;\n\n    const currentScrollTop = boxRef.current.scrollTop;\n\n    if (localVerticalRatio >= 1) {\n      barY.current.style.display = 'none';\n    } else {\n      barY.current.style.display = '';\n      trackerY.current.style.height = `${localTrackerHeight}px`;\n      setTrackerPositionFromScroll(currentScrollTop);\n    }\n  };\n\n  const setScrollPositionFromTracker = (trackerTop: number) => {\n    const progress = trackerTop / (clientHeight.current - trackerHeight.current);\n    if (boxRef.current !== null) {\n      boxRef.current.scroll({\n        top: (scrollHeight.current - clientHeight.current) * progress,\n      });\n    }\n  };\n\n  const dragging = (e: React.MouseEvent) => {\n    const diff = e.clientY - startY.current;\n    const position = Math.min(\n      Math.max(trackerTop.current + diff, 0),\n      clientHeight.current - trackerHeight.current,\n    );\n\n    setScrollPositionFromTracker(position);\n  };\n\n  const dragEnd = () => {\n    if (autoHideScrollbar) {\n      onTrackerDragStop();\n    }\n  };\n\n  const scroll = () => {\n    if (!boxRef.current) {\n      return;\n    }\n    if (autoHideScrollbar) {\n      onTargetScroll();\n    }\n    setTrackerPositionFromScroll(boxRef.current.scrollTop);\n  };\n\n  const dragStart = (e: React.MouseEvent) => {\n    startY.current = e.clientY;\n    trackerTop.current = lastTrackerTop.current;\n\n    if (autoHideScrollbar) {\n      onTrackerDragStart();\n    }\n  };\n\n  return {\n    barRef: barY,\n    trackerVisible,\n    trackerRef: trackerY,\n    resize,\n    dragging,\n    dragEnd,\n    scroll,\n    dragStart,\n    trackerMouseEnter: onTrackerMouseEnter,\n    trackerMouseLeave: onTrackerMouseLeave,\n  };\n};\n"],"names":["React","useTrackerVisibility","useVerticalScrollController","boxRef","autoHideScrollbar","autoHideScrollbarDelay","barY","useRef","verticalRatio","NaN","lastTrackerTop","clientHeight","trackerHeight","scrollHeight","startY","trackerTop","trackerY","trackerVisible","onTargetScroll","onTrackerDragStart","onTrackerDragStop","onTrackerMouseEnter","onTrackerMouseLeave","setVerticalTrackerPosition","scrollTop","current","style","transform","setTrackerPositionFromScroll","progress","resize","localClientHeight","localScrollHeight","localVerticalRatio","localTrackerHeight","Math","max","currentScrollTop","display","height","setScrollPositionFromTracker","scroll","top","dragging","e","diff","clientY","position","min","dragEnd","dragStart","barRef","trackerRef","trackerMouseEnter","trackerMouseLeave"],"mappings":"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"}